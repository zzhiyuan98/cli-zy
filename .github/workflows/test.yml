name: Test cli-zy on macOS

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  test:
    runs-on: macos-14
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install cli-zy
      run: npm install -g .
      
    - name: Test cli-zy setup
      run: cli-zy setup
      
    - name: Verify Homebrew installation
      run: |
        if ! command -v brew >/dev/null 2>&1; then
          echo "‚ùå Homebrew installation failed"
          exit 1
        fi
        
        echo "‚úÖ Homebrew installed successfully"
        brew --version
        
    - name: Verify Git installation
      run: |
        if ! command -v git >/dev/null 2>&1; then
          echo "‚ùå Git installation failed"
          exit 1
        fi
        
        echo "‚úÖ Git installed successfully"
        git --version
        
    - name: Verify nvm installation
      run: |
        # Ê£ÄÊü• nvm ÊòØÂê¶Â∑≤ÂÆâË£Ö
        if [ ! -d "$HOME/.nvm" ]; then
          echo "‚ùå nvm directory not found"
          exit 1
        fi
        
        echo "‚úÖ nvm directory exists"
        
        # ÊâãÂä®Âä†ËΩΩ nvmÔºàÂú®Âêå‰∏Ä‰∏™ shell ‰ºöËØù‰∏≠Ôºâ
        export NVM_DIR="$HOME/.nvm"
        [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
        
        if ! command -v nvm >/dev/null 2>&1; then
          echo "‚ùå nvm failed to load"
          exit 1
        fi
        
        echo "‚úÖ nvm loaded successfully"
        nvm --version
        
    - name: Verify fzf installation
      run: |
        if ! command -v fzf >/dev/null 2>&1; then
          echo "‚ùå fzf installation failed"
          exit 1
        fi
        
        echo "‚úÖ fzf installed successfully"
        fzf --version
        
    - name: Verify Git aliases
      run: |
        if [ -f ~/.zshrc ] && grep -q "alias gca=" ~/.zshrc; then
          echo "‚úÖ Git aliases configured successfully"
          grep "alias gca=" ~/.zshrc
        elif [ -f ~/.bashrc ] && grep -q "alias gca=" ~/.bashrc; then
          echo "‚úÖ Git aliases configured successfully"
          grep "alias gca=" ~/.bashrc
        else
          echo "‚ùå Git aliases configuration failed"
          exit 1
        fi
        
    - name: Test Git aliases
      run: |
        # ÊµãËØï Git Âà´ÂêçÈÖçÁΩÆ
        echo "üîç Checking shell configuration files..."
        ls -la ~/.zshrc ~/.bashrc 2>/dev/null || echo "No config files found"
        
        # Ê£ÄÊü•ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑÂà´ÂêçÂÆö‰πâ
        if [ -f ~/.zshrc ] && grep -q "alias gca=" ~/.zshrc; then
          echo "‚úÖ Git alias 'gca' found in ~/.zshrc"
          grep "alias gca=" ~/.zshrc
        elif [ -f ~/.bashrc ] && grep -q "alias gca=" ~/.bashrc; then
          echo "‚úÖ Git alias 'gca' found in ~/.bashrc"
          grep "alias gca=" ~/.bashrc
        else
          echo "‚ùå Git alias 'gca' not found in configuration files"
          echo "Configuration file contents:"
          if [ -f ~/.zshrc ]; then
            echo "~/.zshrc:"
            cat ~/.zshrc
          fi
          if [ -f ~/.bashrc ]; then
            echo "~/.bashrc:"
            cat ~/.bashrc
          fi
          exit 1
        fi
        
    - name: Show configuration files
      run: |
        echo "üìÑ Shell configuration files:"
        if [ -f ~/.zshrc ]; then
          echo "~/.zshrc exists"
          cat ~/.zshrc | grep -E "(alias|Homebrew|nvm|fzf|Oh My Posh|ws)" || echo "No relevant configurations found"
        fi
        if [ -f ~/.bashrc ]; then
          echo "~/.bashrc exists"
          cat ~/.bashrc | grep -E "(alias|Homebrew|nvm|fzf|Oh My Posh|ws)" || echo "No relevant configurations found"
        fi
        
    - name: Verify workspace shortcut function
      run: |
        # Ê£ÄÊü• ws ÂáΩÊï∞ÊòØÂê¶Â∑≤ÈÖçÁΩÆ
        if [ -f ~/.zshrc ] && grep -q "ws ()" ~/.zshrc; then
          echo "‚úÖ Workspace shortcut function found in ~/.zshrc"
          grep -A 10 "ws ()" ~/.zshrc
        elif [ -f ~/.bashrc ] && grep -q "ws ()" ~/.bashrc; then
          echo "‚úÖ Workspace shortcut function found in ~/.bashrc"
          grep -A 10 "ws ()" ~/.bashrc
        else
          echo "‚ùå Workspace shortcut function not found in configuration files"
          exit 1
        fi
        
    - name: Test workspace shortcut function
      run: |
        # ÊâãÂä®Âä†ËΩΩ shell ÈÖçÁΩÆ‰ª•ÊµãËØï ws ÂáΩÊï∞
        if [ -f ~/.zshrc ]; then
          source ~/.zshrc
        elif [ -f ~/.bashrc ]; then
          source ~/.bashrc
        fi
        
        # Ê£ÄÊü• ws ÂáΩÊï∞ÊòØÂê¶ÂèØÁî®
        if command -v ws >/dev/null 2>&1; then
          echo "‚úÖ ws function is available"
          type ws
        else
          echo "‚ùå ws function is not available"
          exit 1
        fi 